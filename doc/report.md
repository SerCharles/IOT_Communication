---
typora-root-url: ./
---

# 物联网大作业报告

沈冠霖 郭玉楷 周恒宇

## 1. 基本情况

### 1.1 开发环境

- python 3.7.1
- matplotlib 3.3.0
- scipy 1.5.2
- statsmodels 0.12.1
- PyAudio 0.2.11
- numpy 1.19.1
- requests 2.24.0
- Flask 1.1.2

### 1.2 运行方法

我们的代码运行在src下，首先进入这个目录，输入如下命令安装依赖

```shell
pip install -r requirements.txt
```

之后测试FSK解码，请把excel格式的文件命名为content.csv放在src根目录下，将待解调的文件命名为res.wav放在src/receive文件夹下，输入如下命令来运行解码测试程序，获取准确率和解码结果。

```shell
python FSK.py
```

准确率在命令行显示，解码结果在src根目录下的result.csv下

### 1.3 分工

沈冠霖负责FSK调制解调算法

郭玉楷负责蓝牙通信

周恒宇负责测距

## 2. FSK算法

### 2.1 实现方法

我们采用2FSK算法实现调制解调。调制时我们设置每个bit为一个长度为0.025s，频率为4000HZ（0）或6000HZ（1）的信号，组合成一个完整信号。解调时我们先通过匹配前导码的方法找到数据包的开头，然后对每个长度为0.025s的窗口进行傅立叶变化，计算结果最大的频率距离4000HZ还是6000HZ近即可。

匹配前导码是FSK算法的最大难点，因为实际通信的时候并不知道数据包从哪里开始，还有噪声等因素影响。我们首先将前导码的调制结果和整个信号求了相关性，结果如下：

![corr](/corr.png)

对第一个峰放大，结果如下：

![corr_small](/corr_small.png)

可以看出，前20个窗口，也就是前20*0.025 = 0.5s的时间，出现了十个逐步增加的波峰。而最高的波峰应该是前导码完全匹配上的位置，也就是前导码第一个bit对应的窗口的开始位置。

为了正确匹配前导码，我们算法如下：对相关结果，找第一个大于起始阈值的位置t0（起始阈值用来避免前面的录音空白造成的影响），然后求[t0, t0 + 20 * window_length]这个范围内的最大值对应的位置作为数据包开始的位置。

对于一个录音文件里有多个数据包的情况，我们会先匹配第一个数据包的开始，然后先解调前20个bit的前导码和之后长度固定、含有包文长度信息的包头，然后根据包头信息解调包文。之后我们从第一个数据包的结束开始，匹配第二个数据包的前导码以解调包头，以此类推，直到找不到前导码为止。

### 2.2 结果

对于助教提供的content.csv文件和res.wav文件，我们对每个数据包的解码结果都是100%正确。

## 3. 蓝牙通信

### 3.1 实现方法



### 3.2 结果

#### 3.2.1 距离对传输性能影响

| 距离/cm | 丢包率/% | 误码率/% |
| :-----: | :------: | :------: |
|   20    |          |          |
|   40    |          |          |
|   60    |          |          |
|   80    |          |          |
|   100   |          |          |

#### 3.2.2 抗干扰能力

| 噪声大小 | 丢包率/% | 误码率/% |
| :-----: | :------: | :------: |
|   小    |          |          |
|   中   |          |          |
|   大    |          |          |

#### 3.2.3 遮挡影响（固定距离50cm）

| 书籍厚度/cm | 丢包率/% | 误码率/% |
| :-----: | :------: | :------: |
|   1    |          |          |
|   5    |          |          |
|   10    |          |          |
|   20    |          |          |



## 4. 测距

### 4.1 实现方法



### 4.2 结果